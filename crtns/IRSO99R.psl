IRSO99R		/*
	ORIG: titove - 10/31/2005
	DESC: IRS Processing - Form 1099-R Original

	---- Comments --------------------------------------------------------
			  THIS PROCEDURE IS TO BE COMPILED
			      DO NOT RUN STANDALONE

	I18N=QUIT: Excluded from I18N standards.

	---- Revision History ------------------------------------------------

	05/30/07 - DHANALAKSHMI R - CR 25413
 		   Modified the section BRECBLD to include the check for HSA 
 		   with Coverdell ESA. Also modified the "if" condition that 
 		   checks for 0 distribution to correct the Numeric Overflow 
 		   error.

	03/14/07 - KumarSS - CR 25177
		   Removed Invalid Unicode Characters.

 	11/07/06 - SWARNALP - CR 23635
 		   Modified IRA section to set Payment Amount #1 to 
 		   Payment Amount #2 irrespective of the Taxable Amount 
 		   not Determined IRATYPE.TAXIND flag when reporting a 
 		   Normal distribution from a traditional IRA or SEP 
 		   retirement plan.  This is done as part of the Year 2006 
 		   programming changes for magnetic media reporting of IRS 
 		   1098, 1099 & 5498 forms supported by Profile.
 		   
 	09/20/06 - SWARNALP - CR 23178
 		   The following changes are made in this procedure as part of 
		   the Year 2006 programming changes for magnetic media 
		   reporting of IRS 1098, 1099 & 5498 forms supported by 
		   Profile.
		   .	Modified section SPECIAL to allot the field position 
		   	552-559 to the new field 'Date of Designated Roth 
		   	Contribution' but with no processing.
		   .	Modified section IRA to pass "5" as the parameter to 
		   	the extrinsic function call CD^UTL1099R for the two 
		   	combined Profile distribution codes 72 and 95.
		   	
		   Corrected the following defect:
		   .	Form 1099-R should display the distribution amount 
		   	(Payment Amount A) when reporting a distribution made 
		   	from the IRA, SEP, SIMPLE or a Roth Coversion plan 
		   	type (ie. IRA TYPE=1, 4, 11 or 14). So, the section 
		   	IRA and DEATH are modified to use plan type 14 
		   	(Roth Conversion) instead of 16 (Inherited IRA) in 
		   	the condition check while setting AMT(1) to AMT("A").
		   	This defect is corrected upon confirmation from BAs.
 	
 	08/29/06 - SWARNALP - CR 22583
		   Modified BRECBLD to remove the use of the data item IRA.D9 
		   since D9 is a computed column which is for Federal Tax 
		   Withheld and this amount should not get added to IRA.D1 
		   which is a Normal Distribution and is an inclusive of 
		   Federal Tax Withheld amount. It should be noted that the 
		   code in the lower version uses only the 9th piece of 
		   level 0 for IRA which is not available in the table itself 
		   and hence the use of IRA.D9 is removed from section BRECBLD, 
		   CALCAMT and IRA.
		   
 	05/15/06 - DESHPANDE S K - CR 21167
		   Modified section ARECBLD - Initialize STATTOT array based 
		   on StateIds from UTBLSTATID table and also set STATFLG if 
		   UTBLSTATID has data. Modified section BRECBLD to exclude 
		   Nonresident Aliens that have had their Form W-8BEN received 
		   by the institutions and also Set NODUPFLG to 1. Modified 
		   section MTRCNTRL - If STATFLG is set make a call to KRECBLD.
		   Modified section SPECIAL to set STATTOT array values and to 
		   set IRAIND variable. 

	05/01/06 - TITOVE - CR 21024
		   Modified BRECBLD and DEATH sections to append RPASEQ when
		   building a value for CID, instead of IRATYP. Also added
		   code to ensure we have pieces in IRA() arrays that 
		   directly correspond to columns in IRA table.

	04/22/06 - TITOVE - CR 20798
		   Replaced calls to DOCCODE function with calls to
		   CD^UTL1099R function and removed DOCCODE function.
		   Corrected code value for IRA.D95.

	11/01/05 - TITOVE - CR 17287
		   Converted into PSL. Removed unused second argument, IRATYP
		   from DOCCODE function. Added arguments to IRAIND function
		   and made it public. Removed pre-2005 revision history.

	07/12/05 - HILLANBRAND - 16576
		   Corrected issue with SW84 not reporting
		   State Income Tax Withheld amount in Field Position 723-734
		   for Multiple Distribution Code 84. Also fixed issue with the 
		   STATETX reporting for all IRATYPEs instead of just the
		   record being reported.  Moved logic to special subsection.

	06/27/05 - HILLANRAND - 16219
		   Corrected issued with SW49 not reporting.  Modified the state
		   withholding for loop to loop through all reportable columns
		   that are reporting distributions.
	 
	*/

        // Accept "Dead code" warning during runtime of @IRSTAPE
        #ACCEPT Date=11/01/2005;PGM=Eugene Titov;CR=17287
        quit


MTRCNTRL	// Master control

	type public Number ER 
	
	type public Boolean STATFLG
	
	do Db.delete("B1099R")
	
	do ARECBLD quit:ER	// Build and write the "A" record
	
	do BRECBLD quit:ER	// Build and write the "B" records
	
	do CRECBLD quit:ER	// Build and write the "C" record
	
	if (STATFLG = 1) do KRECBLD quit:ER	// Build and write the "K" record
	
	do STORETOT quit:ER	// Store the TTR report totals
	
	quit
	

ARECBLD	// "A" record builder

	type public String TAMT(,)
	type public Number STATTOT(,)
	type public Boolean STATFLG
	
	type Number FORMCODE, I
	type String AMTIND

	set FORMCODE=9		// IRS form code
	set AMTIND="124A"	// IRS amount type indicator
	
	set TAMT(1).piece("|",2)="Gross Distribution"
	set TAMT(2).piece("|",2)="Taxable Amount"
	set TAMT(4).piece("|",2)="Federal Income Tax Withheld"
	set TAMT("A").piece("|",2)="Traditional IRA/SEP/SIMPLE distributions or Roth conversions"
	
	type DbSet ds=Db.selectDbSet("UTBLSTATID")
	
	while ds.next() do {
		
		type RecordUTBLSTATID utblstid=ds.getRecord("UTBLSTATID")
		
		set STATFLG = 1
		set STATTOT(utblstid.statid) = 0
		for I = 1:1:9,13,"A","B","C","D","E" set STATTOT(utblstid.statid,I) = 0
	}
	do ARECWRT		// Write the record to tape
	
	quit
	

BRECBLD	// "B" record builder

	type public Number AMT(), BRAMT(), YEAR

	type Number ACN, CID, FMV, I, IBAL, IRATYP, RPASEQ, STATEID, TAXYR
	type String ADDR, CITY, CNTRY, CORRTN, DISFLG, DOCCODE, FORCNTY, FULLADDR, IRA()
	type String LNAME, NAME, SPECIAL, STATE, TAXIND, TIN, TINTYPE, VAR, ZIP
	
	type DbSet ds=Db.selectDbSet("IRA", "TAXYR=:YEAR")
	
	while ds.next() do {
		
		type RecordIRA ira=ds.getRecord("IRA")
		
		set ACN=ira.acn
		set RPASEQ=ira.rpaseq
	
		type RecordCIF cif = Db.getRecord("CIF", "ACN = :ACN", 1)

		// Exclude Nonresident Aliens that have had their Form W-8BEN 
		// received by the institutions
		if ('cif.w8date.isNull()) quit	
		
		type RecordIRATYPE iratype = Db.getRecord("IRATYPE", "ACN = :ACN, RPASEQ = :RPASEQ", 1)
		
		set IRATYP = iratype.iratyp
		
		// quit if the plan is Coverdell ESA or HSA
		if (IRATYP = 12)!(IRATYP = 18)!(IRATYP = 19) quit
		
		// Initialize IRA() arrays up to a total number of IRA columns
		for I = 1:1:99 do {
			
			set IRA(0).piece("|",I) = ""
			set IRA(2).piece("|",I) = ""
			set IRA(4).piece("|",I) = ""
			}
		
		// Insert values corresponding to eligible columns in IRA table
		for I = 1:1:8,10,12:1:29,34:1:39,43:1:89,94:1:99 do {
			
			set VAR="D"_I
			set IRA(0).piece("|",I) = ira.@VAR
			}		
		
		for I = 1:1:10,12:1:29,34:1:39,43,44,45,47:1:89,94:1:99 do {
			
			set VAR="W"_I
			set IRA(2).piece("|",I) = ira.@VAR
			}
		
		for I = 1:1:8,10,13:1:29,34:1:39,43,44,45,47:1:89,94:1:99 do {
			
			set VAR="SW"_I
			set IRA(4).piece("|",I) = ira.@VAR
			}	
	
		// No distributions and no withholding
		if (IRA(0).translate("|")=0),(IRA(2).translate("|")=0),(IRA(4).translate("|")=0) quit
		
		// Calculate IRA Balance at Year-End
		set TAXYR = YEAR		
		do ^IRAYEBAL
		
		set DISFLG=$select('IBAL:"1",1:" ")
		set TAXIND=$select(iratype.taxind:"1",1:" ")
		set STATEID = iratype.stplnid
		
		set CID=ACN_"-"_RPASEQ		// Account number (sequence number)
		
		set TIN=cif.taxid 		// Taxpayers identification number
		
		set TINTYPE=$select(TIN?2N1"-"7N:1,TIN?3N1"-"2N1"-"4N:2,1:" ") // Type of TIN
	
		// The rest of AMT() entries are initialized at the top of template routine
		set AMT(13)=0	// State Tax W/H amount, needed for IRSFTR1.AMT13 column
		
		set BRAMT(2)=0
		set DOCCODE="  "		// Document specific code
		set CORRTN=" "			// Corrected return indicator
		set NAME = cif.nam	 	// Payee First Name
		set LNAME = cif.lnm  		// Payee Last Name
		
		set FULLADDR=$$FULLADDR^RSPADD(ACN,RPASEQ)
		
		set ADDR=FULLADDR.piece("|",1)_" "_FULLADDR.piece("|",2)_" "_FULLADDR.piece("|",3)
		set CITY=FULLADDR.piece("|",4)	// Payee City
		set STATE=FULLADDR.piece("|",5)	// Payee State
		set ZIP=FULLADDR.piece("|",6).piece("-",1)_FULLADDR.piece("|",6).piece("-",2)  // Payee
		set CNTRY=FULLADDR.piece("|",7)	// Foreign country
		set FORCNTY=$select(FULLADDR.piece("|",7)="US":" ",1:1) // Foreign country indicator	
		
		/*
		  The following values of I represent the different columns in the IRA
		  table that are reportable codes.
		  Note: Number 6 must be last because death changes various CIF values.
		*/
		for I=1,4,5,7,10,15,17,18,19,24,26,28,29,34,36,37,38,39,43,44,48,49,51,53,57,59,61,63,64,65,67,68,69,70,72,73,74,75,76,77,78,80,85,86,89,94,95,96,98,6 do CALCAMT
		}
	
	quit
	

CALCAMT
	/*
	  This function determines which distribution codes to generate the 1099-R
	  form based on the value of Form Cutoff Amount(UTBLIRS.FCTOFF). 
	  Only reportable codes are considered.
	*/
	
	type public Number AMT(), BRAMT(), CUTOFF, I, IRATYP
	type public String IRA(), IRAIND
	
	type Number J

	for J=1:1:9,"A","B","C","D","E" set AMT(J)=0	// Clear amount registers
	
	set BRAMT(2)=0
	
	do IRAIND(IRATYP,.IRAIND)

	// Check for any reportable amounts
	if ((I=4)!(I=5)!(I=6)!(I=7)!(I=15)!(I=17)!(I=24)!(I=26)!(I=28)!(I=29)!(I=36)!(I=37)!(I=38)!(I=39)!(I=43)!(I=44)!(I=48)!(I=89)!(I=94)),(IRA(0).piece("|",I)+IRA(2).piece("|",I)<CUTOFF) quit
	if 'CUTOFF,((I=4)!(I=5)!(I=6)!(I=7)!(I=15)!(I=17)!(I=24)!(I=26)!(I=28)!(I=29)!(I=36)!(I=37)!(I=38)!(I=39)!(I=43)!(I=44)!(I=48)!(I=89)!(I=94)),((IRA(0).piece("|",I)+IRA(2).piece("|",I))=0) quit
	if CUTOFF,((I=63)!(I=64)!(I=67)!(I=68)!(I=69)!(I=72)!(I=73)!(I=95)!(I=75)!(I=76)),((IRA(0).piece("|",I)+IRA(2).piece("|",I))<CUTOFF)) quit
	if 'CUTOFF,((I=63)!(I=64)!(I=67)!(I=68)!(I=69)!(I=72)!(I=73)!(I=95)!(I=75)!(I=76)),((IRA(0).piece("|",I)+IRA(2).piece("|",I))=0)) quit
	if (I=1),(IRA(0).piece("|",1)+IRA(2).piece("|",1)+IRA(2).piece("|",9)+IRA(0).piece("|",10)+IRA(2).piece("|",10)<CUTOFF) quit
	if 'CUTOFF,(I=1),((IRA(0).piece("|",1)+IRA(2).piece("|",1)+IRA(2).piece("|",9)+IRA(0).piece("|",10)+IRA(2).piece("|",10))=0) quit
	if (I=18),(IRA(0).piece("|",18)+IRA(2).piece("|",18)+IRA(0).piece("|",22)+IRA(2).piece("|",22)<CUTOFF) quit
	if 'CUTOFF,(I=18),((IRA(0).piece("|",18)+IRA(2).piece("|",18)+IRA(0).piece("|",22)+IRA(2).piece("|",22))=0) quit
	if (I=19),(IRA(0).piece("|",19)+IRA(2).piece("|",19)+IRA(0).piece("|",23)+IRA(2).piece("|",23)<CUTOFF) quit
	if 'CUTOFF,(I=19),((IRA(0).piece("|",19)+IRA(2).piece("|",19)+IRA(0).piece("|",23)+IRA(2).piece("|",23))=0) quit
	if (I=34),(IRA(0).piece("|",34)+IRA(2).piece("|",34)+IRA(0).piece("|",35)+IRA(2).piece("|",35)<CUTOFF) quit
	if 'CUTOFF,(I=34),((IRA(0).piece("|",34)+IRA(2).piece("|",34)+IRA(0).piece("|",35)+IRA(2).piece("|",35))=0) quit
	if (I=49),((IRA(0).piece("|",I)+IRA(0).piece("|",50)+IRA(2).piece("|",I)+IRA(2).piece("|",50))<CUTOFF) quit
	if 'CUTOFF,(I=49),((IRA(0).piece("|",I)+IRA(0).piece("|",50)+IRA(2).piece("|",I)+IRA(2).piece("|",50))=0) quit
	if (I=51),((IRA(0).piece("|",I)+IRA(0).piece("|",52)+IRA(2).piece("|",I)+IRA(2).piece("|",52))<CUTOFF) quit
	if 'CUTOFF,(I=51),((IRA(0).piece("|",I)+IRA(0).piece("|",52)+IRA(2).piece("|",I)+IRA(2).piece("|",52))=0) quit
	if (I=53),((IRA(0).piece("|",I)+IRA(0).piece("|",54)+IRA(0).piece("|",55)+IRA(0).piece("|",56)+IRA(2).piece("|",I)+IRA(2).piece("|",54)+IRA(2).piece("|",55)+IRA(2).piece("|",56))<CUTOFF) quit
	if 'CUTOFF,(I=53),((IRA(0).piece("|",I)+IRA(0).piece("|",54)+IRA(0).piece("|",55)+IRA(0).piece("|",56)+IRA(2).piece("|",I)+IRA(2).piece("|",54)+IRA(2).piece("|",55)+IRA(2).piece("|",56))=0) quit
	if (I=57),((IRA(0).piece("|",I)+IRA(0).piece("|",58)+IRA(2).piece("|",I)+IRA(2).piece("|",58))<CUTOFF) quit
	if 'CUTOFF,(I=57),((IRA(0).piece("|",I)+IRA(0).piece("|",58)+IRA(2).piece("|",I)+IRA(2).piece("|",58))=0) quit
	if (I=59),((IRA(0).piece("|",I)+IRA(0).piece("|",60)+IRA(2).piece("|",I)+IRA(2).piece("|",60))<CUTOFF) quit
	if 'CUTOFF,(I=59),((IRA(0).piece("|",I)+IRA(0).piece("|",60)+IRA(2).piece("|",I)+IRA(2).piece("|",60))=0) quit
	if (I=61),((IRA(0).piece("|",I)+IRA(0).piece("|",62)+IRA(2).piece("|",I)+IRA(2).piece("|",62))<CUTOFF) quit
	if 'CUTOFF,(I=61),((IRA(0).piece("|",I)+IRA(0).piece("|",62)+IRA(2).piece("|",I)+IRA(2).piece("|",62))=0) quit
	if (I=65),((IRA(0).piece("|",I)+IRA(0).piece("|",66)+IRA(2).piece("|",I)+IRA(2).piece("|",66))<CUTOFF) quit
	if 'CUTOFF,(I=65),((IRA(0).piece("|",I)+IRA(0).piece("|",66)+IRA(2).piece("|",I)+IRA(2).piece("|",66))=0) quit
	if (I=70),((IRA(0).piece("|",I)+IRA(0).piece("|",71)+IRA(2).piece("|",I)+IRA(2).piece("|",71))<CUTOFF) quit
	if 'CUTOFF,(I=70),((IRA(0).piece("|",I)+IRA(0).piece("|",71)+IRA(2).piece("|",I)+IRA(2).piece("|",71))=0) quit
	if (I=74),((IRA(0).piece("|",I)+IRA(2).piece("|",I)+IRA(4).piece("|",I))<CUTOFF) quit
	if 'CUTOFF,(I=74),((IRA(0).piece("|",I)+IRA(2).piece("|",I)+IRA(4).piece("|",I))=0) quit
	if (I=77),((IRA(0).piece("|",I)+IRA(0).piece("|",81)+IRA(2).piece("|",I)+IRA(2).piece("|",81))<CUTOFF) quit
	if 'CUTOFF,(I=77),((IRA(0).piece("|",I)+IRA(0).piece("|",81)+IRA(2).piece("|",I)+IRA(2).piece("|",81))=0) quit
	if (I=78),((IRA(0).piece("|",I)+IRA(0).piece("|",79)+IRA(0).piece("|",82)+IRA(0).piece("|",83)+IRA(2).piece("|",I)+IRA(2).piece("|",79)+IRA(2).piece("|",82)+IRA(2).piece("|",83))<CUTOFF) quit
	if 'CUTOFF,(I=78),((IRA(0).piece("|",I)+IRA(0).piece("|",79)+IRA(0).piece("|",82)+IRA(0).piece("|",83)+IRA(2).piece("|",I)+IRA(2).piece("|",79)+IRA(2).piece("|",82)+IRA(2).piece("|",83))=0) quit
	if (I=80),((IRA(0).piece("|",I)+IRA(0).piece("|",84)+IRA(2).piece("|",I)+IRA(2).piece("|",84))<CUTOFF) quit
	if 'CUTOFF,(I=80),((IRA(0).piece("|",I)+IRA(0).piece("|",84)+IRA(2).piece("|",I)+IRA(2).piece("|",84))=0) quit
	if (I=85),((IRA(0).piece("|",I)+IRA(0).piece("|",87)+IRA(2).piece("|",I)+IRA(2).piece("|",87))<CUTOFF) quit
	if 'CUTOFF,(I=85),((IRA(0).piece("|",I)+IRA(0).piece("|",87)+IRA(2).piece("|",I)+IRA(2).piece("|",87))=0) quit
	if (I=86),((IRA(0).piece("|",I)+IRA(0).piece("|",88)+IRA(2).piece("|",I)+IRA(2).piece("|",88))<CUTOFF) quit
	if 'CUTOFF,(I=86),((IRA(0).piece("|",I)+IRA(0).piece("|",88)+IRA(2).piece("|",I)+IRA(2).piece("|",88))=0) quit
	if (I=96),((IRA(0).piece("|",I)+IRA(0).piece("|",97)+IRA(2).piece("|",I)+IRA(2).piece("|",97))<CUTOFF) quit
	if 'CUTOFF,(I=96),((IRA(0).piece("|",I)+IRA(0).piece("|",97)+IRA(2).piece("|",I)+IRA(2).piece("|",97))=0) quit
	if (I=98),((IRA(0).piece("|",I)+IRA(0).piece("|",99)+IRA(2).piece("|",I)+IRA(2).piece("|",99))<CUTOFF) quit
	if 'CUTOFF,(I=98),((IRA(0).piece("|",I)+IRA(0).piece("|",99)+IRA(2).piece("|",I)+IRA(2).piece("|",99))=0) quit
	
	do IRA
	
	quit


IRA
	/*
		AMT(1)		Gross Distribution Amount 
				IRA(0) node 	
				B1099R.BAMT1 - Payment Amount #1
	
		AMT(4)		Federal Income Tax Withheld amount 
				IRA(2) node
				B1099R.BAMT4 - Payment Amount #4
	
		AMT(13)		Total Reportable State Withholding 
				IRA(4) node
				B1099R.BTOTSTWH -Total Reportable State Withholding
	
		AMT(“A”)	Traditional IRA/SEP/SIMPLE distribution amount 
				IRATYP=1,4,11, or 16 use AMT(1), else 0
				B1099R.BAMTA - Payment Amount #A
	
		BRAMT(2)	Taxable amount
	
		AMT(2)		IRATYP=13 or 15 use 0,  else use AMT(1)  
				B1099R.BAMT2 - Payment Amount #2
	*/
	
	type public Number ACN, AMT(), BRAMT(), I, IRATYP, TAXIND
	type public String DOCCODE, IRA(), IRAIND
	
	type Boolean NODUPFLG = 1
	
	if I=1 do { quit
		set AMT(4)=IRA(2).piece("|",1)+IRA(2).piece("|",9)+IRA(2).piece("|",10)
		set AMT(4)=AMT(4)*100
		set AMT(13)=IRA(4).piece("|",1)+IRA(4).piece("|",9)+IRA(4).piece("|",10)
		set AMT(13)=AMT(13)*100
		set AMT(1)=IRA(0).piece("|",1)+IRA(0).piece("|",10)
		set AMT(1)=AMT(1)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("7 ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=1)!(IRATYP=4) set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=4 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("1 ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=5 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("3 ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=6 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("4 ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do DEATH
		}	
	if I=7 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("5 ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=15 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("6 ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		set IRAIND=" "
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=17 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("2 ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=18 do { quit
		set AMT(4)=(IRA(2).piece("|",18)+IRA(2).piece("|",22))*100
		set AMT(13)=(IRA(4).piece("|",18)+IRA(4).piece("|",22))*100
		set AMT(1)=(IRA(0).piece("|",18)+IRA(0).piece("|",22))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("8 ")
		set AMT(2)=IRA(0).piece("|",22)*100
		set BRAMT(2)=IRA(0).piece("|",22)*100 //insert into B1099R
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=19 do { quit
		set AMT(4)=(IRA(2).piece("|",19)+IRA(2).piece("|",23))*100
		set AMT(13)=(IRA(4).piece("|",19)+IRA(4).piece("|",23))*100
		set AMT(1)=(IRA(0).piece("|",19)+IRA(0).piece("|",23))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("P ")
		set AMT(2)=IRA(0).piece("|",23)*100
		set BRAMT(2)=IRA(0).piece("|",23)*100 //insert into B1099R
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=24 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("D ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=26 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("4G")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=28 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("G ")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=29 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("G ")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=34 do { quit
		set AMT(4)=(IRA(2).piece("|",34)+IRA(2).piece("|",35))*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=(IRA(0).piece("|",34)+IRA(0).piece("|",35))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("2 ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=36 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("S ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=37 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("L ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=38 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("2 ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=39 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("2 ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=43 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		set AMT(2)=0,BRAMT(2)=0   // Taxable amount is 0 for rechars
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("N ")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=44 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("4 ")
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		do DEATH
		}	
	if I=48 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		set AMT(2)=0,BRAMT(2)=0   // Taxable amount is 0 for rechars
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("R ")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=49 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",50))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",50))*100
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",50))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=IRA(0).piece("|",50)*100
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=IRA(0).piece("|",50)*100
		set DOCCODE=$$CD^UTL1099R("18")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=51 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",52))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",52))*100
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",52))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=IRA(0).piece("|",52)*100
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=IRA(0).piece("|",52)*100
		set DOCCODE=$$CD^UTL1099R("28")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=53 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",54)+IRA(2).piece("|",55)+IRA(2).piece("|",56))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",54)+IRA(4).piece("|",55)+IRA(4).piece("|",56))*100
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",54)+IRA(0).piece("|",55)+IRA(0).piece("|",56))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=(IRA(0).piece("|",54)+IRA(0).piece("|",55)+IRA(0).piece("|",56))*100
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=(IRA(0).piece("|",54)+IRA(0).piece("|",55)+IRA(0).piece("|",56))*100
		set DOCCODE=$$CD^UTL1099R("28")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=57 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",58))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",58))*100
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",58))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=IRA(0).piece("|",58)*100
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=IRA(0).piece("|",58)*100
		set DOCCODE=$$CD^UTL1099R("28")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=59 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",60))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",60))*100
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",60))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=IRA(0).piece("|",60)*100
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=IRA(0).piece("|",60)*100
		set DOCCODE=$$CD^UTL1099R("48")
		do DEATH
		}	
	if I=61 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",62))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",62))*100  
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",62))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=IRA(0).piece("|",62)*100
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=IRA(0).piece("|",62)*100
		set DOCCODE=$$CD^UTL1099R("48")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=63 do { quit
		set AMT(4)=(IRA(2).piece("|",63))*100
		set AMT(13)=(IRA(4).piece("|",63))*100  
		set AMT(1)=(IRA(0).piece("|",63))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		set DOCCODE=$$CD^UTL1099R("D1")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=64 do { quit
		set AMT(4)=(IRA(2).piece("|",64))*100
		set AMT(13)=(IRA(4).piece("|",64))*100  
		set AMT(1)=(IRA(0).piece("|",64))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		set DOCCODE=$$CD^UTL1099R("D2")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=65 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",66))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",66))*100  
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",66))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		set DOCCODE=$$CD^UTL1099R("D2")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=67 do { quit
		set AMT(4)=(IRA(2).piece("|",67))*100
		set AMT(13)=(IRA(4).piece("|",67))*100  
		set AMT(1)=(IRA(0).piece("|",67))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		set DOCCODE=$$CD^UTL1099R("D2")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=68 do { quit
		set AMT(4)=(IRA(2).piece("|",68))*100
		set AMT(13)=(IRA(4).piece("|",68))*100  
		set AMT(1)=(IRA(0).piece("|",68))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		set DOCCODE=$$CD^UTL1099R("D4")
		do DEATH
		}	
	if I=69 do { quit
		set AMT(4)=(IRA(2).piece("|",69))*100
		set AMT(13)=(IRA(4).piece("|",69))*100  
		set AMT(1)=(IRA(0).piece("|",69))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		set DOCCODE=$$CD^UTL1099R("D4")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=70 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",71))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",71))*100  
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",71))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=IRA(0).piece("|",71)*100
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=IRA(0).piece("|",71)*100
		set DOCCODE=$$CD^UTL1099R("P1")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=72 do { quit
		set AMT(4)=(IRA(2).piece("|",72))*100
		set AMT(13)=(IRA(4).piece("|",72))*100  
		set AMT(1)=(IRA(0).piece("|",72))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		set DOCCODE=$$CD^UTL1099R("5 ")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=73 do { quit
		set AMT(4)=(IRA(2).piece("|",73))*100
		set AMT(13)=(IRA(4).piece("|",73))*100  
		set AMT(1)=(IRA(0).piece("|",73))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		set DOCCODE=$$CD^UTL1099R("L1")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}	
	if I=74 do { quit
		set AMT(4)=(IRA(2).piece("|",I))*100
		set AMT(1)=(IRA(0).piece("|",I))*100
		set AMT(13)=(IRA(4).piece("|",I))*100
		set AMT(2)=0
		set BRAMT(2)=0
		set DOCCODE=$$CD^UTL1099R("T ")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=75 do { quit
		set AMT(4)=(IRA(2).piece("|",75))*100
		set AMT(13)=(IRA(4).piece("|",75))*100  
		set AMT(1)=(IRA(0).piece("|",75))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		set DOCCODE=$$CD^UTL1099R("L4")
		do DEATH
		}
	if I=76 do { quit
		set AMT(4)=(IRA(2).piece("|",76))*100
		set AMT(13)=(IRA(4).piece("|",76))*100  
		set AMT(1)=(IRA(0).piece("|",76))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		set DOCCODE=$$CD^UTL1099R("L4")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=77 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",81))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",81))*100  
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",81))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=IRA(0).piece("|",81)*100
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=IRA(0).piece("|",81)*100
		set DOCCODE=$$CD^UTL1099R("P2")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=78 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",79)+IRA(2).piece("|",82)+IRA(2).piece("|",83))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",79)+IRA(4).piece("|",82)+IRA(4).piece("|",83))*100
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",79)+IRA(0).piece("|",82)+IRA(0).piece("|",83))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=(IRA(0).piece("|",82)+IRA(0).piece("|",83))*100
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=(IRA(0).piece("|",82)+IRA(0).piece("|",83))*100
		set DOCCODE=$$CD^UTL1099R("P2")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=80 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",84))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",84))*100  
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",84))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=IRA(0).piece("|",84)*100
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=IRA(0).piece("|",84)*100
		set DOCCODE=$$CD^UTL1099R("P2")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=85 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",87))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",87))*100  
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",87))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=IRA(0).piece("|",87)*100
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=IRA(0).piece("|",87)*100
		set DOCCODE=$$CD^UTL1099R("P4")
		do DEATH
		}
	if I=86 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",88))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",88))*100  
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",88))*100
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=IRA(0).piece("|",88)*100
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=IRA(0).piece("|",88)*100
		set DOCCODE=$$CD^UTL1099R("P4")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=89 do { quit
		set AMT(4)=IRA(2).piece("|",I)*100
		set AMT(13)=IRA(4).piece("|",I)*100
		set AMT(1)=IRA(0).piece("|",I)*100
		if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
		else  set AMT(2)=AMT(1)
		if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
		else  set BRAMT(2)=AMT(1)
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		set DOCCODE=$$CD^UTL1099R("Q ")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=94 do { quit
		set AMT(4)=(IRA(2).piece("|",I))*100
		set AMT(1)=(IRA(0).piece("|",I))*100
		set AMT(13)=(IRA(4).piece("|",I))*100
		set AMT(2)=0
		set BRAMT(2)=0
		set DOCCODE=$$CD^UTL1099R("J ")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=95 do { quit
		set AMT(4)=(IRA(2).piece("|",I))*100
		set AMT(1)=(IRA(0).piece("|",I))*100
		set AMT(13)=(IRA(4).piece("|",I))*100
		set AMT(2)=0
		set BRAMT(2)=0
		set DOCCODE=$$CD^UTL1099R("5 ")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=96 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",97))*100
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",97))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",97))*100
		set AMT(2)=0
		set BRAMT(2)=0
		set DOCCODE=$$CD^UTL1099R("J8")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	if I=98 do { quit
		set AMT(4)=(IRA(2).piece("|",I)+IRA(2).piece("|",99))*100
		set AMT(1)=(IRA(0).piece("|",I)+IRA(0).piece("|",99))*100
		set AMT(13)=(IRA(4).piece("|",I)+IRA(4).piece("|",99))*100
		set AMT(2)=0
		set BRAMT(2)=0
		set DOCCODE=$$CD^UTL1099R("JP")
		do SPECIAL,BRECWRT,B1099R(ACN)
		}
	quit
	

DEATH	// Death beneficiary redirection

	type public Number ACN, AMT(), BRAMT(), I, IRATYP, RPASEQ, YEAR
	type public String CID, IRAIND, TAXIND
	
	type Number DISTCODE
	type public String ADDR, CIDSAVE, CITY, CNTRY, DOCCODE, FORCNTY, FULLADDR
	type public String LNAME, NAME, SPECIAL, STATE, TIN, TINTYPE, ZIP
	
	set DISTCODE=I
	
	do IRAIND(IRATYP,.IRAIND)
	
	type DbSet ds1=Db.selectDbSet("IRABEN1","ACN=:ACN AND RPASEQ=:RPASEQ AND CYR=:YEAR")
	
	// No beneficiary
	if ds1.isEmpty() do SPECIAL,BRECWRT,B1099R(ACN) quit
	
	while ds1.next() do {
		
		type RecordIRABEN1 iraben1=ds1.getRecord("IRABEN1")
		
		if DISTCODE=6 do {
			set AMT(4)=iraben1.wth*100
			set AMT(13)=iraben1.totstwh*100  
			set AMT(1)=(iraben1.tamt*100)+AMT(4)+AMT(13)
			if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
			else  set AMT(2)=(iraben1.tamt+iraben1.wth+iraben1.totstwh)*100
			if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
			else  set BRAMT(2)=(iraben1.tamt+iraben1.wth+iraben1.totstwh)*100
			set DOCCODE=$$CD^UTL1099R("4 ")
			}
		
		if DISTCODE=59 do {
			set AMT(4)=(iraben1.wth59+iraben1.wth60)*100
			set AMT(13)=(iraben1.totswh59+iraben1.totswh60)*100  
			set AMT(1)=((iraben1.tamt59+iraben1.tamt60)*100)+AMT(4)+AMT(13)
			if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
			else  set AMT(2)=(iraben1.tamt60+iraben1.wth60+iraben1.totswh60)*100
			if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
			else  set BRAMT(2)=(iraben1.tamt60+iraben1.wth60+iraben1.totswh60)*100
			set DOCCODE=$$CD^UTL1099R("48")
			}
		
		if DISTCODE=68 do {
			set AMT(4)=iraben1.wth68*100
			set AMT(13)=iraben1.totswh68*100
			set AMT(1)=(iraben1.tamt68*100)+AMT(4)+AMT(13)
			if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
			else  set AMT(2)=AMT(1)
			if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
			else  set BRAMT(2)=AMT(1)
			set DOCCODE=$$CD^UTL1099R("D4")
			}
		
		if DISTCODE=75 do {
			set AMT(4)=iraben1.wth75*100
			set AMT(13)=iraben1.totswh75*100
			set AMT(1)=(iraben1.tamt75*100)+AMT(4)+AMT(13)
			if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
			else  set AMT(2)=AMT(1)
			if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
			else  set BRAMT(2)=AMT(1)
			set DOCCODE=$$CD^UTL1099R("L4")
			}
		
		if DISTCODE=85 do {
			set AMT(4)=(iraben1.wth85+iraben1.wth87)*100
			set AMT(13)=(iraben1.totswh85+iraben1.totswh87)*100  
			set AMT(1)=((iraben1.tamt85+iraben1.tamt87)*100)+AMT(4)+AMT(13)
			if (IRATYP=13)!(IRATYP=15)!(TAXIND=1) set AMT(2)=0
			else  set AMT(2)=(iraben1.tamt87+iraben1.wth87+iraben1.totswh87)*100
			if (IRATYP=13)!(IRATYP=15) set BRAMT(2)=0
			else  set BRAMT(2)=(iraben1.tamt87+iraben1.wth87+iraben1.totswh87)*100
	 		set DOCCODE=$$CD^UTL1099R("P4")
			}
		
		if +AMT(1)=0 quit	     // No distribution
		
		if (IRATYP=1)!(IRATYP=4)!(IRATYP=11)!(IRATYP=14) set AMT("A")=AMT(1)
		
		type RecordIRABEN iraben=Db.getRecord("IRABEN","ACN=:ACN,RPASEQ=:RPASEQ,BENSEQ=:iraben1.benseq")
		
		// Beneficiary is a PROFILE customer and address missing in IRABEN table
		if 'iraben.benacn.isNull(),iraben.benmad1.isNull() do {
		
			type RecordCIF cif = Db.getRecord("CIF", "ACN = :iraben.benacn")
			
			set FULLADDR=$$FULLADDR^RSPADD(iraben.benacn,RPASEQ)
		
			quit:FULLADDR.isNull()
			
			set ADDR=FULLADDR.piece("|",1)_" "_FULLADDR.piece("|",2)_" "_FULLADDR.piece("|",3)
			set CITY=FULLADDR.piece("|",4)		// Beneficiary City
			set STATE=FULLADDR.piece("|",5)		// Beneficiary State
			set ZIP=FULLADDR.piece("|",6).piece("-",1)_FULLADDR.piece("|",6).piece("-",2) // Beneficiary Zip
			set CNTRY=FULLADDR.piece("|",7)		// Foreign country
			set FORCNTY=$select(CNTRY="US":" ",1:1)  	// Foreign country indicator
			set TIN=cif.taxid			// Tax ID
			set NAME = cif.nam 			// Beneficiary First Name
			set LNAME = cif.lnm			// Beneficiary Last Name
			}
		// Beneficiary is not a PROFILE customer
		else  do {
			set NAME=iraben.benname			// Beneficiary First Name
			set LNAME=iraben.benlnm			// Beneficiary Last Name
			set TIN=iraben.bentaxid			// Beneficiary TAXID
			// Set line 2 and line 3 of Beneficiary address
			set ADDR=iraben.benmad1_" "_iraben.benmad2_" "_iraben.benmad3
			set FULLADDR.piece("|",1)=iraben.benmad1
			set FULLADDR.piece("|",2)=iraben.benmad2
			set FULLADDR.piece("|",3)=iraben.benmad3
			set CITY=iraben.bencity
			set STATE=iraben.benstate
			set ZIP=iraben.benzip.piece("-",1)
			set FULLADDR.piece("|",6)=ZIP
			set CNTRY=iraben.bencntry
			set FORCNTY=$select(CNTRY="US":" ",1:1)
			}	
	
		type RecordIRATYPE iratype1=Db.getRecord("IRATYPE","ACN=:ACN,RPASEQ=:RPASEQ", 1)

		set TAXIND=$select(iratype1.taxind:"1",1:" ")	
		set CIDSAVE=CID
		set CID=iraben1.benseq_"-"_RPASEQ // Account number (sequence number)
		
		set TINTYPE=$select(TIN?2N1"-"7N:1,TIN?3N1"-"2N1"-"4N:2,1:" ") // Type of TIN
		
		do SPECIAL,BRECWRT,B1099R(iraben1.benseq)
		
		set CID=CIDSAVE
		}
	
	quit


public	SPECIAL	// Build Special Data

	type public Number AMT(), I, STATEID, STATTOT(,)
	type public Boolean STATFLG, NODUPFLG 
	type public String DISFLG, DOCCODE, IRAIND, SPECIAL, TAXIND 
	
	type Number X 
			
	// Special date position 544-750
	//; Blank |544
	set SPECIAL=" "
	//; Document specific code|545|546
	set SPECIAL=SPECIAL_(DOCCODE_"  ").extract(1,2)
	//; Blank |547
	if NODUPFLG,((TAXIND.isNull())!(I=18)!(I=19)!(I=22)!(I=23)!(I=29)!(I=43)!(I=48)) set TAXIND=" "
	set SPECIAL=SPECIAL_TAXIND
	//; IRA/SEP/SIMPLE Indicator |548	
	if IRAIND.isNull() set IRAIND=" "
	set SPECIAL=SPECIAL_IRAIND
	//; Total Distribution Flag (1099-R)|549
	if DISFLG.isNull() set DISFLG=" "
	set SPECIAL=SPECIAL_DISFLG
	//; Blank|550|551
	set SPECIAL=SPECIAL_"  "
	//; Date of Designated Roth Contribution |552|559
	set SPECIAL=SPECIAL_"".justify(8)
	//; Blank |560|662
	set SPECIAL=SPECIAL_"".justify(103)
	//; Special data entries|663|722
	set SPECIAL=SPECIAL_"".justify(60)
	//; State Income Tax Withheld|723|734
	if AMT(13)=0 set SPECIAL=SPECIAL_"".justify(12)
	else  do {
		
		set X = (AMT(13)+1000000000000)
		set SPECIAL=SPECIAL_{String}X.extract(2,13) 
	}
	//; Local Income Tax Withheld|735|746
	set SPECIAL=SPECIAL_"000000000000"
	//; Combined Federal/State Code|747|748
	set SPECIAL=SPECIAL_STATEID
	//; Blank|749|750
	set SPECIAL=SPECIAL_"  "
	
	if (NODUPFLG=1),(STATFLG=1),('STATEID.isNull()) do {

		for X = 1:1:9,13,"A","B","C","D","E" set STATTOT(STATEID,X) = STATTOT(STATEID,X) + AMT(X)
		set STATTOT(STATEID) = 	STATTOT(STATEID) + 1
	} 
	
	quit
	

B1099R(Number ACN)	// Inserting B Records into B1099R File

	type public Number AMT(), BRAMT(), FAMT(), FCNT, STATEID, TINTYPE
	type public String CID, CITY, DISFLG, DOCCODE, IRAIND, FULLADDR, LNAME, NAME
	type public String STATE, TAXIND, TIN

	type Number BSEQ
	type String NAMCON, X

	if (TINTYPE=2) set X=LNAME
	else  set X=NAME
	
	do NAMCNTRL^IRSTPMTR
	
	set NAMCON=X
	
	set BSEQ=Db.nextVal("B1099R","PDATE=:%SystemDate,BACN=:ACN")
		
	type RecordB1099R b1099r=Db.getRecord("B1099R","PDATE=:%SystemDate,BACN=:ACN,BSEQ=:BSEQ", 1)
	
	set b1099r.bnamcon=NAMCON
	set b1099r.btintype=TINTYPE
	set b1099r.btin=TIN.translate(" ","-")
	set b1099r.bcid=CID
	set b1099r.bamt1=AMT(1)/100
	set b1099r.bamt2=BRAMT(2)/100
	set b1099r.bamt4=AMT(4)/100
	set b1099r.bamta=AMT("A")/100
	set b1099r.bname=NAME
	set b1099r.baddr1=FULLADDR.piece("|",1)
	set b1099r.baddr2=FULLADDR.piece("|",2)
	set b1099r.baddr3=FULLADDR.piece("|",3)
	set b1099r.bcity=CITY
	set b1099r.bstate=STATE
	set b1099r.bzip=FULLADDR.piece("|",6)
	set b1099r.bdoccd=(DOCCODE_"  ").extract(1,2)
	set b1099r.bissi=IRAIND
	set b1099r.btotfl=DISFLG
	set b1099r.btaxind=TAXIND
	set b1099r.btotstwh=AMT(13)/100
	set b1099r.bplnid=STATEID
	
	do b1099r.save()

	// Calculate number of records and tax form report totals
	set FCNT=FCNT+1
	set FAMT(1)=FAMT(1)+(AMT(1)/100)
	set FAMT(2)=FAMT(2)+(BRAMT(2)/100)
	set FAMT(3)=FAMT(3)+(AMT(4)/100)
	set FAMT(13)=FAMT(13)+(AMT(13)/100)
	
	quit
	

public	IRAIND(Number IRATYP,
	       String IRAIND)	

	// Determine if the account is IRA/SEP/SIMPLE

	if (IRATYP=1)!(IRATYP=2)!(IRATYP=4)!(IRATYP=10)!(IRATYP=11)!(IRATYP=16) set IRAIND=1
	else  set IRAIND=" "
	
	quit
	

CRECBLD	// "C" record builder

	do CRECWRT	// Write the record to tape
	
	quit
	

KRECBLD	// "K" record builder
	
	type public Number STATTOT(,)
	type String STID
	type public Number ER
	
	set STID =  ""
	
	for  set STID = STATTOT(STID).order() quit:STID.isNull()  do { quit:ER
	
		if STATTOT(STID) > 0 do KRECWRT	// Write the record to tape
	}
	
	quit


%STOPLOD	// Stop %ZRTNLOD from this point on down
	quit
TRECWRT		// Dummy line reference for GT.M
	quit
ARECWRT		// Dummy line reference for GT.M
	quit
BRECWRT		// Dummy line reference for GT.M
	quit
CRECWRT		// Dummy line reference for GT.M
	quit
KRECWRT		// Dummy line reference for GT.M	
	quit
STORETOT	// Dummy line reference for GT.M
	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60787^21273^Dhanalakshmi R^44623"	// Signature - LTD^TIME^USER^SIZE
